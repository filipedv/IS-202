@model OBLIG1.Models.ObstacleData
@{
    ViewData["Title"] = "Register Obstacle";
}

<section class="mx-auto max-w-2xl">
    <div class="bg-white rounded-2xl shadow-sm ring-1 ring-gray-200 p-6">
        <header class="mb-6">
            <h1 class="text-2xl font-semibold">Obstacle Registration Form</h1>
            <p class="text-gray-600 mt-1">Please register an obstacle:</p>
        </header>

        
        <form asp-action="DataForm" method="post" class="space-y-5">
            <div class="grid gap-5 sm:grid-cols-2">
                
                
                <!-- Obstacle Name -->
                <div class="sm:col-span-2">
                    <label asp-for="ObstacleName" class="block text-sm font-medium text-gray-800 mb-1">Obstacle Name</label>
                    <input asp-for="ObstacleName"
                           class="block w-full rounded-lg border-gray-300 focus:border-indigo-600 focus:ring-indigo-600 px-3 py-2"
                           placeholder="e.g., Wall, Ramp"/>
                    <span asp-validation-for="ObstacleName" class="text-sm text-red-600"></span>
                </div>


                <!-- Høyde -->
                <div>
                    <label asp-for="ObstacleHeight" class="block text-sm font-medium text-gray-800 mb-1">
                        Obstacle Height (meters)
                    </label>
                    <input asp-for="ObstacleHeight" type="number" step="0.01" min="0"
                           class="block w-full rounded-lg border-gray-300 focus:border-indigo-600 focus:ring-indigo-600 px-3 py-2"
                           placeholder="e.g., 2.5"/>
                    <span asp-validation-for="ObstacleHeight" class="text-sm text-red-600"></span>
                </div>


                <!-- Beskrivelse -->
                <div class="sm:col-span-2">
                    <label asp-for="ObstacleDescription" class="block text-sm font-medium text-gray-800 mb-1">
                        Obstacle Description
                    </label>
                    <textarea asp-for="ObstacleDescription" rows="4"
                              class="block w-full rounded-lg border-gray-300 focus:border-indigo-600 focus:ring-indigo-600 px-3 py-2"
                              placeholder="Describe the obstacle, materials, location, etc."></textarea>
                    <span asp-validation-for="ObstacleDescription" class="text-sm text-red-600"></span>
                </div>
            </div>

            
            <!-- Kartseksjon -->
            <div class="space-y-3">
                <div class="flex items-center justify-between">
                    <label class="block text-sm font-medium text-gray-800">Locate the obstacle on the map</label>
                </div>
                <div id="map" style="height: 420px; border-radius: 0.75rem; overflow: hidden; border: 1px solid #e5e7eb;"></div>

    
                <!-- Skjult felt som overfører FeatureCollection som JSON tilbake til serveren -->
                <input type="hidden" asp-for="GeometryGeoJson" id="GeometryGeoJson" />

    
                <!-- Vise koordinater i read only felt -->
                <div>
                    <label for="CoordinatesPreview" class="block text-sm font-medium text-gray-800 mb-1">Coordinates Preview</label>
                    <textarea id="CoordinatesPreview" class="block w-full rounded-lg border-gray-300 px-3 py-2 text-sm" rows="5" readonly placeholder="Draw on the map to see coordinates here..."></textarea>
                </div>
            </div>
        </form>
        
        
        <!-- Submit Data -->
        <div class="mt-6 mb-12">
            <button type="submit"
                    class="inline-flex items-center justify-center rounded-lg bg-indigo-600 px-6 py-3 text-white text-lg font-semibold hover:bg-indigo-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 shadow-md">
                Submit Obstacle
            </button>
        </div>
    </div>
</section>


@section Scripts {
    <!-- If you use client-side validation, keep the standard validation partial -->
    <partial name="_ValidationScriptsPartial" />

    
    <!-- Links to Leaflet CSS and Draw Sources -->
 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
 <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />

 <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
 <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script> 
    
 <script>
     var map = L.map('map').setView([58.1467, 7.9956], 13); // Kart sentrert på Kristiansand
     
     // Legge til et bakgrunnskart
         L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
             attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
         }).addTo(map);
     
         // Initialisere feature gruppen som skal holde de tegnede objekter
         var drawnItems = new L.FeatureGroup();
         map.addLayer(drawnItems);

         // Oppretter tegnekontrollen på venstreside
         // Tegnekontrollen gjør det mulig å tegne markører, polygoner og polylinjer
         var drawControl = new L.Control.Draw({
             draw: {
                 polygon: false,
                 polyline: true,
                 marker: true,
                 circle: false,  // Deaktivere tegning av sirkler
                 rectangle: true
             },
             edit: {
                 featureGroup: drawnItems
             }
         });
         map.addControl(drawControl);

         // Håndtering av hendelser når et lag tegnes på kartet
         map.on(L.Draw.Event.CREATED, function (e) {
                 layer = e.layer;

             drawnItems.addLayer(layer);

             // Hent GeoJSON-versjon av det laget som er tegnet
             var geoJsonData = layer.toGeoJSON();
             var geoJsonString = JSON.stringify(geoJsonData);

             // Sette GeoJSON-strengen inn i det skjulte feltet i skjemaet
             document.getElementById('GeometryGeoJson').value = geoJsonString;
             document.getElementById('CoordinatesPreview').value = geoJsonString;
         });
 </script>
}
